<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="default"/>
<meta name="apple-mobile-web-app-title" content="USA 2025"/>
<title>USA 2025 Adventure</title>
<style>
:root{
  --primary: #FF385C; --primary-light: #FFE8ED; --secondary: #00A699; --success: #34C759;
  --text-primary: #1D1D1F; --text-secondary: #6E6E73; --text-tertiary: #8E8E93;
  --bg-primary: #FFFFFF; --bg-secondary: #F2F2F7; --surface: #FFFFFF;
  --separator: rgba(60,60,67,0.12); --link: #007AFF;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.04); --shadow-md: 0 4px 12px rgba(0,0,0,0.08); --shadow-lg: 0 8px 32px rgba(0,0,0,0.12); --shadow-xl: 0 16px 64px rgba(0,0,0,0.16);
  --radius-lg: 16px; --radius-xl: 20px; --radius-2xl: 24px;
  --spring: cubic-bezier(0.175, 0.885, 0.32, 1.275); --ease-ios: cubic-bezier(0.25, 0.1, 0.25, 1);
  --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","Helvetica Neue",Arial,sans-serif;
  background:var(--bg-secondary); color:var(--text-primary);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  overflow-x:hidden; padding-top:var(--safe-top);
}

/* ========== Header & Hero ========== */
.status-aware-header{position:sticky; top:0; z-index:100; background:rgba(255,255,255,0.8); backdrop-filter:saturate(180%) blur(20px); -webkit-backdrop-filter:saturate(180%) blur(20px); border-bottom:0.5px solid var(--separator); padding:8px 20px;}
.nav-container{max-width:1200px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; height:48px;}
.logo{font-size:20px; font-weight:700; color:var(--primary); display:flex; align-items:center; gap:6px;}
.hero{background:var(--bg-primary); padding:32px 20px 40px; text-align:center;}
.hero-title{font-size:clamp(32px, 8vw, 48px); font-weight:800; letter-spacing:-0.02em; line-height:1.1; margin-bottom:8px;}
.hero-subtitle{font-size:18px; font-weight:500; color:var(--text-secondary); margin-bottom:24px;}
.countdown-container{display:flex; justify-content:center; gap:12px; margin-top:24px; flex-wrap:wrap;}
.countdown-card{background:var(--surface); border:1px solid var(--separator); border-radius:var(--radius-lg); padding:16px 12px; min-width:72px; box-shadow:var(--shadow-sm);}
.countdown-value{font-size:28px; font-weight:800; color:var(--primary); line-height:1; display:block; font-variant-numeric:tabular-nums;}
.countdown-label{font-size:12px; font-weight:600; color:var(--text-tertiary); text-transform:uppercase; letter-spacing:0.5px; margin-top:4px;}

/* ========== Content Sections ========== */
.content-section{background:var(--bg-primary); margin:8px; border-radius:var(--radius-xl); overflow:hidden; box-shadow:var(--shadow-md);}
.section-header{padding:24px 20px 16px; border-bottom:1px solid var(--separator);}
.section-title{font-size:24px; font-weight:700; color:var(--text-primary); margin-bottom:4px;}
.section-subtitle{font-size:16px; color:var(--text-secondary);}
.section-content{padding:20px;}

/* ========== Destinations Hub (Main Component) ========== */
.tabs{display:flex;gap:12px;margin-bottom:24px;overflow-x:auto;flex-wrap:nowrap;padding:4px 20px;margin-left:-20px;margin-right:-20px; scrollbar-width:none;}
.tabs::-webkit-scrollbar{display:none;}
.tab{padding:10px 20px;background:var(--surface);border:1px solid var(--separator);border-radius:30px;font-weight:600;cursor:pointer;transition:all .3s var(--ease-ios); white-space:nowrap; flex-shrink:0;}
.tab.active{background:var(--primary);color:#fff;border-color:var(--primary);transform:translateY(-2px);box-shadow:0 8px 16px rgba(255,56,92,.25)}
.tab:hover:not(.active){transform:translateY(-1px);box-shadow:var(--shadow-md)}
.main-card{background:var(--surface);border-radius:var(--radius-xl);overflow:hidden;box-shadow:var(--shadow-lg);display:flex;transition:opacity .4s var(--ease-ios), transform .4s var(--ease-ios);opacity:0;transform:translateY(20px)}
.main-card.visible{opacity:1;transform:translateY(0)}
.hero-image{flex:1;min-height:500px;background-size:cover;background-position:center;position:relative;display:flex;flex-direction:column;justify-content:flex-end;padding:32px;color:#fff}
.hero-image::after{content:"";position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.7) 0%,rgba(0,0,0,0) 55%)}
.hero-image-title{position:relative;z-index:1;font-size:36px;font-weight:800;line-height:1.2}
.hero-area{position:relative;z-index:1;font-size:18px;font-weight:500;opacity:.95;margin-top:4px}
.content-column{flex:0 0 350px;padding:24px;display:flex;flex-direction:column;gap:24px;max-height:500px;overflow-y:auto; background:var(--bg-secondary);}
.info-item{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--separator);font-size:16px}
.info-item:last-child{border-bottom:none}
.info-item span:first-child{color:var(--text-secondary)}
.info-item span:last-child{font-weight:600}
.weather-main{display:flex;align-items:center;gap:16px;margin-bottom:12px}
.weather-icon{font-size:46px;animation:float 3s ease-in-out infinite}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.weather-temp{font-size:40px;font-weight:800}
.weather-desc{font-size:15px;color:var(--text-secondary)}
.widget{background:var(--surface);border:1px solid var(--separator);box-shadow:var(--shadow-sm);border-radius:var(--radius-lg);padding:20px}
.widget h3{font-size:18px;font-weight:700;margin-bottom:12px;color:var(--text-primary)}
.widget-list{display:grid;gap:12px}
.widget-item{display:flex;gap:14px;padding:12px;border:1px solid var(--separator);border-radius:var(--radius-lg);align-items:center;transition:transform .15s var(--ease-ios),background .15s var(--ease-ios)}
.widget-item:hover{transform:translateY(-2px);background:var(--primary-light)}
.widget-icon{font-size:24px;width:30px;text-align:center}
.widget-text h4{font-size:16px;font-weight:600}
.widget-text p{font-size:14px;color:var(--text-secondary)}
.widget-item.a{cursor:pointer;text-decoration:none;color:inherit}

/* ========== Weather Overlay ========== */
.wx-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.4);backdrop-filter:blur(10px);opacity:0;pointer-events:none;transition:opacity .35s ease;z-index:2200;display:flex;align-items:center;justify-content:center}
.wx-overlay.show{opacity:1;pointer-events:auto}
.wx-sheet{position:relative;overflow:hidden;color:#fff;border-radius:var(--radius-2xl);box-shadow:0 30px 80px rgba(0,0,0,.4);width:min(500px,94vw);max-height:min(86vh,900px);display:flex;flex-direction:column; transform:scale(0.95); transition:transform 0.3s var(--spring);}
.wx-overlay.show .wx-sheet{transform:scale(1);}
.wx-sunny{background:linear-gradient(135deg,#f6d365,#fda085)}
.wx-cloudy{background:linear-gradient(135deg,#7f8fa6,#718093)}
.wx-rainy{background:linear-gradient(135deg,#74b9ff,#0984e3)}
.wx-close{position:absolute;top:12px;right:12px;border:none;background:rgba(255,255,255,.15);backdrop-filter:blur(6px);color:#fff;border-radius:50%;width:32px;height:32px;cursor:pointer;z-index:10; font-size:16px;}
.wx-top{padding:22px;position:relative}
.weather-animation{position:absolute;inset:0;pointer-events:none}
.rain-drop{position:absolute;width:2px;height:20px;background:rgba(255,255,255,0.6);border-radius:1px;animation:rain 1s linear infinite}
@keyframes rain{0%{transform:translateY(-10px);opacity:0}50%{opacity:1}100%{transform:translateY(60px);opacity:0}}
.wx-city{font-weight:800;letter-spacing:.3px}
.wx-meta{display:flex;align-items:baseline;gap:10px;margin-top:6px}
.wx-temp-lg{font-size:56px;font-weight:900;line-height:1}
.wx-desc-lg{opacity:.95}
.wx-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
.wx-chip{background:rgba(255,255,255,.18);border:1px solid rgba(255,255,255,.25);border-radius:12px;padding:10px 12px;font-size:14px;display:flex;justify-content:space-between}
.wx-body{background:rgba(0,0,0,.12);backdrop-filter:blur(4px);padding:14px;overflow:auto}
.wx-body h4{font-size:16px;font-weight:600;margin-bottom:8px;opacity:0.9;}
.wx-row{display:flex;gap:10px;overflow-x:auto;padding-bottom:6px; scrollbar-width:none;}
.wx-row::-webkit-scrollbar{display:none}
.wx-hour{min-width:72px;text-align:center;background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.22);border-radius:12px;padding:10px}
.wx-hour .t{font-weight:800}
.wx-days{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px}
.wx-day{background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.22);border-radius:12px;padding:10px;text-align:center}
.wx-day .hi{font-weight:800}
.wx-day .lo{opacity:.85}

/* ========== Moments & Flights Section ========== */
.moments-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(280px, 1fr));gap:16px;}
.moment-card{background:var(--surface);border:1px solid var(--separator);border-radius:var(--radius-lg);padding:20px;transition:all 0.2s var(--ease-ios);cursor:pointer;}
.moment-card:hover{transform:translateY(-4px);box-shadow:var(--shadow-lg);border-color:var(--primary);}
.moment-header{display:flex;align-items:center;gap:12px;margin-bottom:12px;}
.moment-icon{font-size:32px;}
.moment-title{font-size:18px;font-weight:600;}
.moment-description{font-size:14px;color:var(--text-secondary);line-height:1.5;}
.flights-list{display:grid;gap:16px;}
.flight-card{background:var(--surface);border:1px solid var(--separator);border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow-sm);}
.flight-header{padding:16px 20px;border-bottom:1px solid var(--separator);}
.flight-route{font-size:20px;font-weight:700;}
.flight-date{font-size:14px;color:var(--text-secondary);}
.flight-details{padding:20px;display:grid;grid-template-columns:repeat(auto-fit, minmax(100px, 1fr));gap:16px;}
.detail-label{font-size:12px;color:var(--text-tertiary);text-transform:uppercase;margin-bottom:4px;}
.detail-value{font-size:16px;font-weight:600;}
.flight-status{background:rgba(52,199,89,0.15);color:#34C759;font-size:12px;font-weight:600;padding:6px 12px;border-radius:var(--radius-lg);display:inline-block;}

/* ========== Packing Section ========== */
.packing-container{padding:20px;}
.packing-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px;}
.packing-stat{background:var(--bg-secondary);padding:16px;border-radius:var(--radius-lg);text-align:center;}
.stat-value{font-size:24px;font-weight:800;color:var(--primary);display:block;font-variant-numeric:tabular-nums;}
.stat-label{font-size:12px;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:0.5px;margin-top:4px;}
.packing-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;background:var(--bg-secondary);border-radius:var(--radius-lg);padding:20px;}
@media (max-width:640px){.packing-grid{grid-template-columns:1fr}}
.packing-column{background:var(--surface);border:2px dashed var(--separator);border-radius:var(--radius-lg);padding:16px;min-height:200px;transition:all 0.3s var(--ease-ios);}
.packing-column.drag-over{border-color:var(--primary);background:var(--primary-light);}
.column-title{font-size:16px;font-weight:600;color:var(--text-primary);margin-bottom:16px;display:flex;align-items:center;gap:8px;}
.packing-list{list-style:none;}
.packing-item{background:var(--surface);border:1px solid var(--separator);border-radius:var(--radius-lg);padding:12px;margin-bottom:8px;display:flex;align-items:center;gap:12px;cursor:grab;transition:all 0.2s var(--ease-ios);box-shadow:var(--shadow-sm);}
.packing-item:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);}
.packing-item.dragging{transform:scale(1.05) rotate(2deg);box-shadow:var(--shadow-lg);z-index:1000;}
.item-text{flex:1;}
.packed .item-text{color:var(--text-secondary);text-decoration:line-through;}

/* ========== Concierge & Modals ========== */
.concierge-btn{position:fixed;bottom:calc(var(--safe-bottom) + 20px);right:20px;background:var(--primary);color:#fff;border:none;width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:var(--shadow-xl);transition:all .3s var(--spring);z-index:1000}
.concierge-btn:hover{transform:translateY(-3px) scale(1.05);box-shadow:0 12px 40px rgba(255,56,92,.4)}
.concierge-btn .icon{font-size:24px}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:flex-end;justify-content:center;opacity:0;pointer-events:none;transition:opacity .4s ease;z-index:2000}
.modal-overlay.show{opacity:1;pointer-events:auto}
.modal{background:var(--surface);border-radius:var(--radius-xl) var(--radius-xl) 0 0;padding:16px 20px calc(var(--safe-bottom) + 20px);width:100%;max-width:500px;transform:translateY(100%);transition:transform .4s var(--spring)}
.modal-overlay.show .modal{transform:translateY(0)}
.modal-handle{width:36px;height:4px;background:var(--separator);border-radius:2px;margin:0 auto 16px}
.modal-title{font-size:20px;font-weight:600;text-align:center;margin-bottom:16px;}
.quick-actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:14px}
.quick-action{display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-secondary);border-radius:var(--radius-lg);text-decoration:none;color:inherit;transition:transform .2s var(--ease-ios), background .2s var(--ease-ios)}
.quick-action:hover{transform:translateY(-4px);background:var(--primary-light)}
.quick-action .icon{font-size:28px;margin-bottom:10px}
.quick-action .label{font-weight:600;font-size:14px;text-align:center}
.modal-overlay-custom{position:fixed; inset:0; background:rgba(0,0,0,0.5); backdrop-filter:blur(10px); z-index:1000; display:flex; align-items:center; justify-content:center; opacity:0; pointer-events:none; transition:opacity 0.3s var(--ease-ios);}
.modal-overlay-custom.show{opacity:1; pointer-events:auto;}
.modal-content-custom{background:var(--surface); border-radius:var(--radius-xl); max-width:600px; width:90%; max-height:85vh; overflow:hidden; display:flex; flex-direction:column; transform:scale(0.95); transition:transform 0.3s var(--spring);}
.modal-overlay-custom.show .modal-content-custom{transform:scale(1);}
.modal-header-custom{padding:16px 20px; border-bottom:1px solid var(--separator); display:flex; justify-content:space-between; align-items:center;}
.modal-title-custom{font-size:20px; font-weight:600;}
.modal-close-btn{background:var(--bg-secondary); border:0; width:32px; height:32px; border-radius:50%; cursor:pointer; font-size:16px; display:flex; align-items:center; justify-content:center;}
.modal-body-custom{padding:20px; overflow-y:auto;}
.modal-list-item{display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg-secondary);border-radius:var(--radius-lg);margin-bottom:8px;}
.modal-item-text strong{display:block;font-size:16px;font-weight:600;}
.modal-item-text span{font-size:14px;color:var(--text-secondary);}
.modal-item-action{background:var(--primary);color:white;text-decoration:none;padding:8px 16px;border-radius:var(--radius-lg);font-size:14px;font-weight:600;}

/* Vegas Birthday Section */
.vegas-birthday {
    position: relative;
    margin: 8px;
    border-radius: var(--radius-xl);
    overflow: hidden;
    background: #0A0A0F;
    color: #FFFFFF;
    padding: 32px 20px;
    text-align: center;
}
.vegas-backdrop {
    position: absolute;
    inset: 0;
    z-index: 1;
    background: 
        radial-gradient(ellipse at 20% 0%, #9D00FF 0%, transparent 40%),
        radial-gradient(ellipse at 80% 100%, #FF1493 0%, transparent 40%),
        #0A0A0F;
    animation: vegasGlow 10s ease-in-out infinite alternate;
}
@keyframes vegasGlow { 0% { opacity: 0.7; } 100% { opacity: 1; } }
.vegas-content { position: relative; z-index: 10; }
.neon-title {
    font-size: clamp(36px, 10vw, 64px);
    font-weight: 900;
    line-height: 1;
    background: linear-gradient(45deg, #FFD700, #FF1493, #00F5FF);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 0 15px #FF1493);
    animation: gradientMove 3s linear infinite, neonPulse 2s ease-in-out infinite;
    margin-bottom: 8px;
}
@keyframes gradientMove { to { background-position: 200% center; } }
@keyframes neonPulse { 50% { filter: drop-shadow(0 0 25px #FF1493); } }
.vegas-subtitle { font-size: 16px; color: rgba(255, 255, 255, 0.8); margin-bottom: 24px; }
.jackpot-btn {
    background: linear-gradient(135deg, #FFD700, #FF6B35);
    color: #0A0A0F;
    border: none;
    border-radius: var(--radius-lg);
    padding: 18px 32px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s var(--spring);
    box-shadow: 0 8px 32px rgba(255, 215, 0, 0.4);
    margin-top: 24px;
}
.jackpot-btn:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 12px 40px rgba(255, 215, 0, 0.6); }
#vegasConfettiCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; }
.slot-machine-container { max-height: 0; opacity: 0; overflow: hidden; transition: max-height 0.5s ease-out, opacity 0.5s ease-out, margin-top 0.5s ease-out; }
.slot-machine-container.visible { max-height: 150px; opacity: 1; margin-top: 20px; }
.slot-machine { display: flex; justify-content: center; gap: 12px; padding: 10px; background: linear-gradient(180deg, #1F1F2E, #0A0A0F); border-radius: 16px; border: 2px solid #FFD700; box-shadow: inset 0 0 15px rgba(255, 215, 0, 0.2); }
.slot-reel { width: 80px; height: 100px; background: #151521; border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1); overflow: hidden; position: relative; }
.slot-reel::after { content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, rgba(255,255,255,0.15) 0%, transparent 20%, transparent 80%, rgba(0,0,0,0.3) 100%); z-index: 2; }
.reel-strip span { display: flex; align-items: center; justify-content: center; height: 100px; font-size: 50px; color: #fff; }
.vegas-toast { position: fixed; top: 20px; left: 50%; transform: translate(-50%, -120px); background: rgba(20, 20, 35, 0.9); backdrop-filter: blur(10px); border: 1px solid #FFD700; border-radius: var(--radius-lg); padding: 16px 24px; display: flex; align-items: center; gap: 12px; z-index: 10000; box-shadow: 0 10px 30px rgba(0,0,0,0.4); color: #fff; transition: transform 0.5s var(--spring); }
.vegas-toast.show { transform: translate(-50%, 0); }

@media (max-width: 800px){
  .main-card{flex-direction:column}
  .content-column{max-height:none}
  .hero-image{min-height:420px}
}
.animate-on-scroll{opacity:0;transform:translateY(20px);transition:all 0.6s var(--ease-ios);}
.animate-on-scroll.visible{opacity:1;transform:translateY(0);}

</style>
</head>
<body>
  <header class="status-aware-header">
    <div class="nav-container">
      <div class="logo">USA 2025 ✈️</div>
    </div>
  </header>

  <section class="hero">
    <h1 class="hero-title">Your American Adventure</h1>
    <p class="hero-subtitle">September 19 – October 3, 2025 • 15 Days</p>
    <div class="countdown-container">
      <div class="countdown-card"><span class="countdown-value" id="days">--</span><div class="countdown-label">Days</div></div>
      <div class="countdown-card"><span class="countdown-value" id="hours">--</span><div class="countdown-label">Hours</div></div>
      <div class="countdown-card"><span class="countdown-value" id="minutes">--</span><div class="countdown-label">Minutes</div></div>
      <div class="countdown-card"><span class="countdown-value" id="seconds">--</span><div class="countdown-label">Seconds</div></div>
    </div>
  </section>

  <main>
    <section id="destinations-hub" class="content-section animate-on-scroll">
        <div class="section-header">
            <h2 class="section-title">Destinations & Stays</h2>
            <p class="section-subtitle">Your interactive trip itinerary</p>
        </div>
        <div class="section-content">
            <div class="tabs" id="tabs" role="tablist"></div>
            <div class="main-card" id="main-card" aria-live="polite">
              <div class="hero-image" id="hero-image">
                <h2 class="hero-image-title" id="hero-title"></h2>
                <p class="hero-area" id="hero-area"></p>
              </div>
              <aside class="content-column" id="content-column"></aside>
            </div>
        </div>
    </section>

    <section class="vegas-birthday animate-on-scroll">
      <div class="vegas-backdrop"></div>
      <canvas id="vegasConfettiCanvas"></canvas>
      <div class="vegas-content">
        <h2 class="neon-title">DIRTY 30</h2>
        <p class="vegas-subtitle">The Strip • September 28th</p>
        <button class="jackpot-btn" id="jackpotBtn" onclick="playSlots()">🎰 Hit The Jackpot 🎰</button>
        <div class="slot-machine-container" id="slotMachineContainer">
            <div class="slot-machine">
                <div class="slot-reel"><div class="reel-strip" id="reel1"></div></div>
                <div class="slot-reel"><div class="reel-strip" id="reel2"></div></div>
                <div class="slot-reel"><div class="reel-strip" id="reel3"></div></div>
            </div>
        </div>
      </div>
    </section>
    
    <section id="dynamic-moments-section" class="content-section animate-on-scroll">
      <div class="section-header">
        <h2 class="section-title">Epic Moments</h2>
        <p class="section-subtitle">Unforgettable experiences planned</p>
      </div>
      <div class="section-content">
        <div class="moments-grid" id="dynamic-moments-grid"></div>
      </div>
    </section>

    <section id="dynamic-flights-section" class="content-section animate-on-scroll">
        <div class="section-header">
            <h2 class="section-title">Flight Schedule</h2>
            <p class="section-subtitle">Your journey to the next stop</p>
        </div>
        <div class="section-content">
            <div class="flights-list" id="dynamic-flights-list"></div>
        </div>
    </section>

    <section class="content-section animate-on-scroll">
      <div class="section-header">
        <h2 class="section-title">Packing Checklist</h2>
        <p class="section-subtitle">Stay organized for your trip</p>
      </div>
      <div class="packing-container">
        <div class="packing-stats">
          <div class="packing-stat"><span class="stat-value" id="packedCount">0</span><div class="stat-label">Packed</div></div>
          <div class="packing-stat"><span class="stat-value" id="totalCount">0</span><div class="stat-label">Total</div></div>
          <div class="packing-stat"><span class="stat-value" id="packingPercent">0%</span><div class="stat-label">Complete</div></div>
        </div>
        <div class="packing-grid">
          <div class="packing-column" id="toPackColumn"><h3 class="column-title">📦 To Pack</h3><ul class="packing-list" id="toPackList"></ul></div>
          <div class="packing-column" id="packedColumn"><h3 class="column-title">✅ Packed</h3><ul class="packing-list" id="packedList"></ul></div>
        </div>
      </div>
    </section>
  </main>

  <div class="wx-overlay" id="wx-overlay" onclick="toggleWx(false)">
    <div class="wx-sheet" id="wx-sheet" onclick="event.stopPropagation()">
      <button class="wx-close" onclick="toggleWx(false)">✕</button>
      <div class="wx-top">
        <div id="wx-anim-detail" class="weather-animation"></div>
        <div class="wx-city" id="wx-city"></div><div class="wx-meta"><div class="wx-temp-lg" id="wx-temp-lg"></div><div class="wx-desc-lg" id="wx-desc-lg"></div></div>
        <div class="wx-grid">
          <div class="wx-chip"><span>Feels like</span><span id="wx-feels"></span></div><div class="wx-chip"><span>Humidity</span><span id="wx-hum"></span></div>
          <div class="wx-chip"><span>Wind</span><span id="wx-wind"></span></div><div class="wx-chip"><span>Rain %</span><span id="wx-rain"></span></div>
        </div>
      </div>
      <div class="wx-body">
        <h4>Next 8 Hours</h4><div class="wx-row" id="wx-hourly-cards"></div>
        <h4 style="margin-top:16px;">Next 3 Days</h4><div class="wx-days" id="wx-days-cards"></div>
      </div>
    </div>
  </div>
  
  <button class="concierge-btn" onclick="toggleConcierge()"><span class="icon">✨</span></button>
  <div class="modal-overlay" id="concierge-overlay" onclick="toggleConcierge()">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-handle"></div>
      <div class="modal-title" id="concierge-title"></div>
      <div class="quick-actions" id="quick-actions"></div>
    </div>
  </div>

  <div class="modal-overlay-custom" id="modalOverlayCustom" onclick="closeCustomModal()"><div class="modal-content-custom" onclick="event.stopPropagation()"><div class="modal-header-custom"><h2 class="modal-title-custom" id="modalTitleCustom"></h2><button class="modal-close-btn" onclick="closeCustomModal()">✕</button></div><div class="modal-body-custom" id="modalBodyCustom"></div></div></div>

<script>
/* ========== GLOBAL STATE & DATA ========== */
const cities = {
  sanfran:{
    name:"San Francisco", hero:"https://images.unsplash.com/photo-1506146332389-18140dc7b241?auto=format&fit=crop&w=1400&q=80", dates:"19–23 Sep", area:"Union Square", lat:37.7749, lon:-122.4194,
    food:[
        {icon:"🍞", name:"Boudin Bakery", desc:"Sourdough bowls at the Wharf.", url:"https://www.google.com/maps/search/?api=1&query=Boudin+Bakery+Fisherman%27s+Wharf"},
        {icon:"🥗", name:"Greens Restaurant", desc:"Iconic vegetarian dining with views.", url:"https://www.google.com/maps/search/?api=1&query=Greens+Restaurant+Fort+Mason", veg:true},
        {icon:"🌯", name:"La Taqueria", desc:"Authentic Mission-style burritos.", url:"https://www.google.com/maps/search/?api=1&query=La+Taqueria+San+Francisco"},
        {icon:"🍫", name:"Ghirardelli Square", desc:"World-famous chocolate & sundaes.", url:"https://www.google.com/maps/search/?api=1&query=Ghirardelli+Square"}
    ],
    moments:[
        {id:"ggSunrise", icon:"🌉", title:"Golden Gate Sunrise", description:"First light at Battery Spencer. Have layers ready for the wind."},
        {id:"alcatraz", icon:"⛓️", title:"Alcatraz Island Tour", description:"Explore the infamous prison."},
        {id:"cableCar", icon:"🚃", title:"Ride a Cable Car", description:"Climb the hills of SF."},
        {id:"muirWoods", icon:"🌲", title:"Walk with Giants", description:"Visit the majestic redwood forest at Muir Woods."}
    ],
    flights:[ {route:"LON → SFO", date:"Sep 19", number:"TA 017", status:"Booked"} ],
    concierge:[ {icon:"🗺️", label:"Maps", url:"https://www.google.com/maps/search/?api=1&query=Union+Square+San+Francisco"}, {icon:"☕", label:"Coffee", url:"https://www.google.com/maps/search/?api=1&query=coffee+near+Union+Square+SF"}, {icon:"💊", label:"Pharmacy", url:"https://www.google.com/maps/search/?api=1&query=pharmacy+near+Union+Square+SF"} ]
  },
  yosemite:{
    name:"Yosemite", hero:"https://images.unsplash.com/photo-1519045395453-6d0422c54b42?auto=format&fit=crop&w=1400&q=80", dates:"23–26 Sep", area:"Yosemite Valley", lat:37.7456, lon:-119.5936,
    food:[
        {icon:"🍕", name:"Curry Village Pizza", desc:"Casual outdoor patio pies.", url:"https://www.google.com/maps/search/?api=1&query=Curry+Village+Pizza+Deck"},
        {icon:"🍔", name:"Village Grill Deck", desc:"Classic grill fare with great views. Veggie burgers available.", url:"https://www.google.com/maps/search/?api=1&query=Village+Grill+Yosemite", veg:true},
        {icon:"🏨", name:"The Ahwahnee Dining", desc:"Historic fine dining experience.", url:"https://www.google.com/maps/search/?api=1&query=The+Ahwahnee+Dining+Room"}
    ],
    moments:[
        {id:"stargazing", icon:"🌌", title:"Yosemite Stargazing", description:"Milky Way hunt from Glacier Point or Tunnel View."},
        {id:"mistTrail", icon:"💦", title:"Hike the Mist Trail", description:"Get soaked by Vernal Fall."},
        {id:"sequoias", icon:"🌲", title:"Mariposa Grove", description:"Walk among giant sequoias."},
        {id:"tunnelViewSunset", icon:"🌅", title:"Tunnel View Sunset", description:"Watch the valley light up at golden hour."}
    ],
    concierge:[ {icon:"🏔️", label:"Visitor Center", url:"https://www.google.com/maps/search/?api=1&query=Yosemite+Valley+Visitor+Center"}, {icon:"🥾", label:"Trail Maps", url:"https://www.nps.gov/yose/planyourvisit/maps.htm"}, {icon:"🚌", label:"Shuttle", url:"https://www.nps.gov/yose/planyourvisit/publictransportation.htm"} ]
  },
  vegas:{
    name:"Las Vegas", hero:"https://images.unsplash.com/photo-1580006825960-4a173930b8df?auto=format&fit=crop&w=1400&q=80", dates:"26 Sep–1 Oct", area:"The Strip", lat:36.1699, lon:-115.1398,
    food:[
        {icon:"🍽️", name:"Bacchanal Buffet", desc:"Caesars’ legendary mega buffet.", url:"https://www.google.com/maps/search/?api=1&query=Bacchanal+Buffet"},
        {icon:"🌱", name:"Crossroads Kitchen", desc:"Upscale, popular plant-based dining.", url:"https://www.google.com/maps/search/?api=1&query=Crossroads+Kitchen+Las+Vegas", veg:true},
        {icon:"🌮", name:"Tacos El Gordo", desc:"Famous Tijuana-style tacos.", url:"https://www.google.com/maps/search/?api=1&query=Tacos+El+Gordo+Las+Vegas"},
        {icon:"🥩", name:"Gordon Ramsay Steak", desc:"High-end steakhouse experience.", url:"https://www.google.com/maps/search/?api=1&query=Gordon+Ramsay+Steak+Las+Vegas"}
    ],
    moments:[
        {id:"vegasNight", icon:"🎰", title:"Vegas Boys Night", description:"Neon crawl: Bellagio → Chandelier Bar → Fremont."},
        {id:"sphere", icon:"🌐", title:"MSG Sphere", description:"Arrive early, centre seats for full dome experience."},
        {id:"grandCanyon", icon:"🚁", title:"Grand Canyon Trip", description:"Heli West Rim or road to South Rim."},
        {id:"hooverDam", icon:"🌊", title:"Hoover Dam", description:"Morning tour, Boulder City coffee stop."},
        {id:"rooftopToast", icon:"🥂", title:"Rooftop Toast", description:"Legacy Club • Skyfall • Foundation Room."},
        {id:"neonBoneyard", icon:"💀", title:"Neon Boneyard", description:"Explore the history of Vegas through its signs."}
    ],
    flights:[ {route:"LAS → NYC", date:"Oct 1", number:"DJ 442", status:"Booked"} ],
    concierge:[ {icon:"🎰", label:"Casinos", url:"https://www.google.com/maps/search/?api=1&query=casinos+Las+Vegas+Strip"}, {icon:"🍸", label:"Bars", url:"https://www.google.com/search?q=best+cocktail+bars+las+vegas"}, {icon:"🎭", label:"Shows", url:"https://www.google.com/search?q=las+vegas+shows+tickets"} ]
  },
  nyc:{
    name:"New York City", hero:"https://images.unsplash.com/photo-1546436836-07a91091f160?auto=format&fit=crop&w=1400&q=80", dates:"1–3 Oct", area:"Midtown", lat:40.7128, lon:-74.0060,
    food:[
        {icon:"🍕", name:"Joe’s Pizza", desc:"The quintessential NY slice.", url:"https://www.google.com/maps/search/?api=1&query=Joe%27s+Pizza+NYC"},
        {icon:"🥙", name:"The Halal Guys", desc:"Famous street cart (falafel avail.)", url:"https://www.google.com/maps/search/?api=1&query=The+Halal+Guys", veg: true},
        {icon:"🥯", name:"Russ & Daughters", desc:"Iconic bagels and lox.", url:"https://www.google.com/maps/search/?api=1&query=Russ+%26+Daughters"},
        {icon:"🍜", name:"Ippudo", desc:"World-class ramen bowls.", url:"https://www.google.com/maps/search/?api=1&query=Ippudo+NYC"}
    ],
    moments:[
        {id:"broadway", icon:"🎭", title:"Broadway Night", description:"Matinee + dinner or late show + stroll."},
        {id:"topOfRock", icon:"🏙️", title:"Top of the Rock", description:"Unbeatable skyline views."},
        {id:"streetFood", icon:"🥡", title:"NYC Street Food", description:"Slices, bagels, halal — easy walking loop."},
        {id:"brooklynBridge", icon:"🌉", title:"Brooklyn Bridge Walk", description:"Iconic walk for incredible skyline views."},
        {id:"heliTour", icon:"🚁", title:"Manhattan Heli Tour", description:"See the Big Apple from the sky."}
    ],
    flights:[ {route:"NYC → LON", date:"Oct 3", number:"AH 021", status:"Booked"} ],
    concierge:[ {icon:"🗺️", label:"Subway", url:"https://new.mta.info/map/5256"}, {icon:"🍕", label:"Pizza", url:"https://www.google.com/search?q=best+pizza+slice+nyc"}, {icon:"🎭", label:"Broadway", url:"https://www.broadway.com/"} ]
  }
};
let currentCityId = 'sanfran';
let weatherCache = new Map();

const packingItems = [
  { id: 'passport', text: 'Passport & Docs' }, { id: 'clothes', text: 'All-Climate Clothes' },
  { id: 'camera', text: 'Camera & Charger' }, { id: 'hiking', text: 'Hiking Gear' },
  { id: 'sunglasses', text: 'Sunglasses' }, { id: 'meds', text: 'Medications' },
  { id: 'formal', text: 'Vegas/NYC Outfit' }, { id: 'adapter', text: 'Power Adapter' },
];
let packedItems = [];

/* ========== INITIALIZATION ========== */
document.addEventListener('DOMContentLoaded', () => {
    setupCountdown();
    observeScrollAnimations();
    buildTabs();
    switchCity(currentCityId, true);
    renderPackingLists();
});

/* ========== CORE UI FUNCTIONS ========== */
function setupCountdown() {
  const tripDate = new Date('2025-09-19T09:00:00-07:00');
  const update = () => {
    const diff = tripDate.getTime() - new Date().getTime();
    if (diff <= 0) {
      document.querySelector('.countdown-container').innerHTML = `<div style="font-size:18px;font-weight:600;color:var(--success);">🎉 Adventure Time!</div>`;
      clearInterval(countdownInterval);
      return;
    }
    const set = (id, v) => document.getElementById(id).textContent = String(v).padStart(2,'0');
    set('days', Math.floor(diff / 864e5));
    set('hours', Math.floor((diff % 864e5) / 36e5));
    set('minutes', Math.floor((diff % 36e5) / 6e4));
    set('seconds', Math.floor((diff % 6e4) / 1e3));
  };
  update();
  const countdownInterval = setInterval(update, 1000);
}

function observeScrollAnimations() {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
  }, { threshold: 0.1 });
  document.querySelectorAll('.animate-on-scroll').forEach(el => observer.observe(el));
}

function buildTabs() {
  const container = document.getElementById('tabs');
  container.innerHTML = Object.keys(cities).map((id, i) =>
    `<button class="tab ${i===0?'active':''}" data-city="${id}">${cities[id].name}</button>`
  ).join('');
  container.addEventListener('click', e => { if (e.target.matches('.tab')) switchCity(e.target.dataset.city); });
}

function switchCity(cityId, isInitial = false) {
  currentCityId = cityId;
  const city = cities[cityId];
  const card = document.getElementById('main-card');
  
  const updateContent = () => {
    document.getElementById('hero-image').style.backgroundImage = `url('${city.hero}')`;
    document.getElementById('hero-title').textContent = city.name;
    document.getElementById('hero-area').textContent = city.area;

    const foodHtml = `
      <div class="widget">
        <h3>Good Food Spots</h3>
        <div class="widget-list">
          ${city.food.map(item => `
            <a class="widget-item a" href="${item.url}" target="_blank" rel="noopener">
              <div class="widget-icon">${item.icon}</div>
              <div class="widget-text">
                <h4>${item.name} ${item.veg ? '<span style="color:var(--success);font-size:12px;">🌱</span>' : ''}</h4>
                <p>${item.desc}</p>
              </div>
            </a>
          `).join('')}
        </div>
      </div>`;

    document.getElementById('content-column').innerHTML = `
      <div style="background:var(--surface);padding:16px;border-radius:var(--radius-lg);">
        <div class="info-item"><span>Dates</span><span>${city.dates}</span></div>
        <div class="info-item"><span>Area</span><span>${city.area}</span></div>
      </div>
      <div class="widget" style="cursor:pointer;" id="weather-widget">
        <h3>Live Weather</h3>
        <div class="weather-main"><div class="weather-icon">⏳</div><div><div class="weather-temp">--°C</div><div class="weather-desc">Loading...</div></div></div>
      </div>
      ${foodHtml}
      `;
      
    renderWeather(cityId);
    renderDynamicSections(cityId);
    document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.city === cityId));
    card.classList.add('visible');
  };

  if (isInitial) {
    updateContent();
  } else {
    card.classList.remove('visible');
    setTimeout(updateContent, 300);
  }
}

function renderDynamicSections(cityId) {
    const city = cities[cityId];

    const momentsSection = document.getElementById('dynamic-moments-section');
    const momentsGrid = document.getElementById('dynamic-moments-grid');
    if (city.moments?.length > 0) {
        momentsGrid.innerHTML = city.moments.map(moment => `<article class="moment-card" onclick="openCustomModal('moment', '${moment.id}')"><div class="moment-header"><div class="moment-icon">${moment.icon}</div><h3 class="moment-title">${moment.title}</h3></div><p class="moment-description">${moment.description}</p></article>`).join('');
        momentsSection.style.display = 'block';
    } else {
        momentsSection.style.display = 'none';
    }

    const flightsSection = document.getElementById('dynamic-flights-section');
    const flightsList = document.getElementById('dynamic-flights-list');
    if (city.flights?.length > 0) {
        flightsList.innerHTML = city.flights.map(flight => `<article class="flight-card"><div class="flight-header"><div class="flight-route">${flight.route}</div><div class="flight-date">${flight.date}</div></div><div class="flight-details"><div class="flight-detail"><div class="detail-label">Flight</div><div class="detail-value">${flight.number}</div></div><div class="flight-detail"><div class="detail-label">Status</div><div class="flight-status">${flight.status}</div></div></div></article>`).join('');
        flightsSection.style.display = 'block';
    } else {
        flightsSection.style.display = 'none';
    }
}

/* ========== WEATHER LOGIC ========== */
async function fetchWeather(city) {
    const cache = weatherCache.get(city.name);
    if (cache && (Date.now() - cache.ts) < 900000) return cache.data;
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current=temperature_2m,apparent_temperature,relative_humidity_2m,weather_code,wind_speed_10m,precipitation_probability&hourly=temperature_2m,weather_code,precipitation_probability&daily=temperature_2m_max,temperature_2m_min,weather_code&windspeed_unit=kmh&timezone=auto&forecast_days=7`;
    try {
        const res = await fetch(url);
        if (!res.ok) throw new Error('API Error');
        const data = await res.json();
        weatherCache.set(city.name, { data, ts: Date.now() });
        return data;
    } catch (e) { console.error("Weather fetch failed:", e); return null; }
}

async function renderWeather(cityId) {
    const city = cities[cityId];
    const widget = document.getElementById('weather-widget');
    if (!widget) return;
    const data = await fetchWeather(city);
    if (!data) { widget.querySelector('.weather-desc').textContent = "Failed to load"; return; }
    const current = data.current;
    widget.querySelector('.weather-icon').textContent = wmoIcon(current.weather_code);
    widget.querySelector('.weather-temp').textContent = `${Math.round(current.temperature_2m)}°C`;
    widget.querySelector('.weather-desc').textContent = weatherDescriptions[current.weather_code] || 'Clear';
    widget.onclick = () => openWeatherDetail(city, data);
}

function openWeatherDetail(city, data) {
    const { current, hourly, daily } = data;
    const type = wmoAnimType(current.weather_code);
    document.getElementById('wx-sheet').className = `wx-sheet wx-${type}`;
    document.getElementById('wx-anim-detail').innerHTML = wmoAnimHTML(type);
    document.getElementById('wx-city').textContent = city.name;
    document.getElementById('wx-temp-lg').textContent = `${Math.round(current.temperature_2m)}°`;
    document.getElementById('wx-desc-lg').textContent = weatherDescriptions[current.weather_code] || 'Clear';
    document.getElementById('wx-feels').textContent = `${Math.round(current.apparent_temperature)}°`;
    document.getElementById('wx-hum').textContent = `${current.relative_humidity_2m}%`;
    document.getElementById('wx-wind').textContent = `${Math.round(current.wind_speed_10m)} km/h`;
    document.getElementById('wx-rain').textContent = `${current.precipitation_probability}%`;
    const startIndex = hourly.time.findIndex(t => new Date(t) > new Date());
    document.getElementById('wx-hourly-cards').innerHTML = hourly.time.slice(startIndex, startIndex + 8).map((time, i) => {
        const index = startIndex + i;
        return `<div class="wx-hour"><div>${new Date(time).getHours()}:00</div><div style="font-size:22px;margin:4px 0">${wmoIcon(hourly.weather_code[index])}</div><div class="t">${Math.round(hourly.temperature_2m[index])}°</div></div>`;
    }).join('');
    document.getElementById('wx-days-cards').innerHTML = daily.time.slice(0, 3).map((date, i) => `
        <div class="wx-day"><div>${new Date(date).toLocaleDateString('en-US', {weekday:'short'})}</div><div style="font-size:22px;margin:6px 0">${wmoIcon(daily.weather_code[i])}</div><div><span class="hi">${Math.round(daily.temperature_2m_max[i])}°</span> / <span class="lo">${Math.round(daily.temperature_2m_min[i])}°</span></div></div>
    `).join('');
    toggleWx(true);
}

function toggleWx(open = true) {
    const overlay = document.getElementById('wx-overlay');
    if (open) {
        overlay.classList.add('show'); document.body.style.overflow = 'hidden';
    } else {
        overlay.classList.remove('show'); document.body.style.overflow = '';
    }
}

/* ========== CONCIERGE & MODAL LOGIC ========== */
function toggleConcierge() {
    const overlay = document.getElementById('concierge-overlay');
    const isOpen = overlay.classList.contains('show');
    if (!isOpen) {
        const city = cities[currentCityId];
        document.getElementById('concierge-title').textContent = `${city.name} Concierge`;
        document.getElementById('quick-actions').innerHTML = city.concierge.map(a => `<a class="quick-action" href="${a.url}" target="_blank" rel="noopener"><div class="icon">${a.icon}</div><div class="label">${a.label}</div></a>`).join('');
    }
    overlay.classList.toggle('show');
    document.body.style.overflow = isOpen ? '' : 'hidden';
}

function openCustomModal(type, id) {
  const modal = document.getElementById('modalOverlayCustom');
  const title = document.getElementById('modalTitleCustom');
  const body = document.getElementById('modalBodyCustom');
  const data = momentData[id];
  title.textContent = data.title;
  body.innerHTML = `
    <p style="color:var(--text-secondary); line-height:1.6; margin-bottom: 24px;">${data.description}</p>
    <h4 style="font-size: 16px; font-weight: 600; margin-bottom:12px;">📍 Key Locations & Notes</h4>
    ${data.locations.map(loc => `
      <div class="modal-list-item">
        <div class="modal-item-text"><strong>${loc.name}</strong><span>${loc.why}</span></div>
        <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc.name)}" target="_blank" class="modal-item-action">Map</a>
      </div>`).join('')}
  `;
  modal.classList.add('show');
  document.body.style.overflow = 'hidden';
}

function closeCustomModal() {
  document.getElementById('modalOverlayCustom').classList.remove('show');
  document.body.style.overflow = '';
}

/* ========== BIRTHDAY & SLOT MACHINE ========== */
const slotSymbols = ['💎', '🍒', '7️⃣', '🎰', '🔔'];
let isSpinning = false;

function playSlots() {
    if (isSpinning) return;
    isSpinning = true;

    const container = document.getElementById('slotMachineContainer');
    container.classList.add('visible');

    const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
    const results = reels.map(() => slotSymbols[Math.floor(Math.random() * slotSymbols.length)]);
    
    reels.forEach((reel, i) => {
        const strip = Array.from({ length: 30 }, () => slotSymbols[Math.floor(Math.random() * slotSymbols.length)]);
        strip[strip.length - 2] = results[i]; // Set final symbol
        reel.innerHTML = strip.map(symbol => `<span>${symbol}</span>`).join('');

        reel.style.transition = 'none';
        reel.style.transform = 'translateY(0)';
        void reel.offsetHeight; // Force reflow

        const finalPosition = (strip.length - 2) * 100;
        reel.style.transition = `transform ${2500 + i * 500}ms cubic-bezier(0.25, 0.1, 0.25, 1)`;
        reel.style.transform = `translateY(-${finalPosition}px)`;
    });

    setTimeout(() => {
        const isWin = results.every(val => val === results[0]);
        if (isWin) {
            celebrateBirthday();
        } else {
            showVegasToast('😂', 'So close! Try again!');
        }
        isSpinning = false;
    }, 3500);
}

function celebrateBirthday() {
    triggerJackpotConfetti();
    showVegasToast('🎉', 'JACKPOT! Happy 30th!');
    if (navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 200]);
}

function triggerJackpotConfetti() {
    const canvas = document.getElementById('vegasConfettiCanvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    canvas.width = canvas.parentElement.offsetWidth;
    canvas.height = canvas.parentElement.offsetHeight;
    
    const particles = [];
    const colors = ['#FFD700', '#FF1493', '#00F5FF'];
    const emojis = ['💰', '🎰', '💎', '🎉'];
    
    for (let i = 0; i < 150; i++) {
        const isEmoji = Math.random() > 0.8;
        particles.push({
            x: canvas.width / 2, y: canvas.height,
            vx: (Math.random() - 0.5) * 10, vy: -Math.random() * 15 - 5,
            size: isEmoji ? 24 : Math.random() * 8 + 4,
            color: colors[Math.floor(Math.random() * colors.length)],
            emoji: isEmoji ? emojis[Math.floor(Math.random() * emojis.length)] : null,
            opacity: 1, gravity: 0.2
        });
    }

    function animateConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach((p, i) => {
            p.vy += p.gravity; p.x += p.vx; p.y += p.vy;
            p.opacity -= 0.005;
            ctx.globalAlpha = p.opacity;
            if (p.emoji) {
                ctx.font = `${p.size}px Arial`;
                ctx.fillText(p.emoji, p.x, p.y);
            } else {
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);
            }
            if (p.opacity <= 0) particles.splice(i, 1);
        });
        if (particles.length > 0) requestAnimationFrame(animateConfetti);
    }
    animateConfetti();
}

function showVegasToast(icon, message) {
    const existing = document.querySelector('.vegas-toast');
    if(existing) existing.remove();
    
    const toast = document.createElement('div');
    toast.className = 'vegas-toast';
    toast.innerHTML = `<span style="font-size:24px">${icon}</span><span>${message}</span>`;
    document.body.appendChild(toast);
    
    setTimeout(() => toast.classList.add('show'), 10);
    setTimeout(() => {
        toast.classList.remove('show');
        toast.addEventListener('transitionend', () => toast.remove());
    }, 3000);
}


/* ========== PACKING LOGIC ========== */
function renderPackingLists() {
    const toPackList = document.getElementById('toPackList');
    const packedList = document.getElementById('packedList');
    toPackList.innerHTML = packingItems.map(item => `<li class="packing-item" draggable="true" data-id="${item.id}"><span class="item-text">${item.text}</span></li>`).join('');
    packedList.innerHTML = packedItems.map(item => `<li class="packing-item packed" draggable="true" data-id="${item.id}"><span class="item-text">${item.text}</span></li>`).join('');
    updatePackingStats();
    addDragListeners();
}

function updatePackingStats() {
    const total = packingItems.length + packedItems.length;
    document.getElementById('packedCount').textContent = packedItems.length;
    document.getElementById('totalCount').textContent = total;
    document.getElementById('packingPercent').textContent = total > 0 ? `${Math.round((packedItems.length / total) * 100)}%` : '0%';
}

function addDragListeners() {
    document.querySelectorAll('.packing-item').forEach(item => {
        item.addEventListener('dragstart', e => {
            e.target.classList.add('dragging');
            e.dataTransfer.setData('text/plain', e.target.dataset.id);
        });
        item.addEventListener('dragend', e => e.target.classList.remove('dragging'));
    });

    document.querySelectorAll('.packing-column').forEach(col => {
        col.addEventListener('dragover', e => {
            e.preventDefault();
            col.classList.add('drag-over');
        });
        col.addEventListener('dragleave', e => col.classList.remove('drag-over'));
        col.addEventListener('drop', e => {
            e.preventDefault();
            col.classList.remove('drag-over');
            const id = e.dataTransfer.getData('text/plain');
            const fromList = packedItems.find(i => i.id === id) ? packedItems : packingItems;
            const toList = col.id === 'packedColumn' ? packedItems : packingItems;
            const itemIndex = fromList.findIndex(i => i.id === id);
            if(itemIndex > -1 && fromList !== toList) {
                const [item] = fromList.splice(itemIndex, 1);
                toList.push(item);
                renderPackingLists();
            }
        });
    });
}


const momentData = {
  ggSunrise:{ title:'Golden Gate Sunrise', description:'Catching the first light over the iconic bridge from the Marin Headlands. Remember to bring a wind-proof layer!', locations:[{name:'Battery Spencer', why:'The classic postcard view'}, {name:'Hawk Hill', why:'A higher, wider perspective'}]},
  alcatraz:{ title:'Alcatraz Island Tour', description:'Explore the historic and infamous island prison in the San Francisco Bay. Book tickets well in advance!', locations:[{name:'Alcatraz Island', why:'Main prison tour'}, {name:'Pier 33 Alcatraz Landing', why:'Ferry departure point'}]},
  cableCar:{ title:'Ride a Cable Car', description:"Experience San Francisco's iconic moving landmark and see the city from a unique angle.", locations:[{name:'Powell-Hyde Cable Car Line', why:'Most scenic route'}, {name:'Cable Car Museum', why:'See the giant winding wheels'}]},
  muirWoods:{ title:'Walk with Giants', description:'A serene trip to Muir Woods National Monument to stand in awe of the coastal redwoods.', locations:[{name:'Muir Woods National Monument', why:'Main visitor trails'}, {name:'Muir Beach Overlook', why:'Stunning coastal views nearby'}]},
  stargazing:{ title:'Yosemite Stargazing', description:'Witness the Milky Way in a certified dark sky park, far from city lights.', locations:[{name:'Glacier Point', why:'Panoramic sky with Half Dome'}, {name:'Tunnel View', why:'Iconic valley view, also great for stars'}]},
  mistTrail:{ title:'Hike the Mist Trail', description:'A signature Yosemite hike to the base of the powerful Vernal Fall. Bring a poncho!', locations:[{name:'Vernal Fall Footbridge', why:'First great viewpoint'}, {name:'Top of Vernal Fall', why:'Feel the power (and spray)'}]},
  sequoias:{ title:'Mariposa Grove', description:'Walk among a forest of giant sequoia trees, some of the largest living things on Earth.', locations:[{name:'Grizzly Giant', why:'One of the largest trees'}, {name:'California Tunnel Tree', why:'The famous walk-through tree'}]},
  tunnelViewSunset: { title:'Tunnel View Sunset', description:"Watch the last light of day paint El Capitan and Half Dome in incredible colors from this classic viewpoint.", locations:[{name:'Tunnel View, Yosemite', why:'The most famous viewpoint in the park'}]},
  vegasNight:{ title:'Vegas Boys Night', description:"A celebratory night out exploring iconic bars and neon-lit streets.", locations:[{name:'The Chandelier Bar', why:'Cocktails inside a crystal masterpiece'},{name:'Fountains of Bellagio', why:'Classic Vegas spectacle'}, {name:'Fremont Street Experience', why:'Classic neon & live music'}]},
  sphere:{ title:'MSG Sphere Experience', description:"An absolute must-see. The future of immersive entertainment. Arrive early for the full experience and aim for central seats.", locations:[{name:'MSG Sphere Las Vegas', why:'The main attraction'}]},
  grandCanyon:{ title:'Grand Canyon Trip', description:'Take a helicopter from Las Vegas for a breathtaking flight over and into the Grand Canyon.', locations:[{name:"Maverick Helicopters Las Vegas", why:"Departure terminal for West Rim"}, {name:"Grand Canyon South Rim", why:"Accessible by road for a full day trip"}]},
  hooverDam:{ title:'Hoover Dam Tour', description:"A morning tour to marvel at this incredible feat of modern engineering.", locations:[{name:'Hoover Dam', why:'Take the Power Plant or Full Dam Tour'}, {name:"Boulder City", why:"Historic town for a coffee stop"}]},
  rooftopToast:{ title:'Rooftop Toast', description:"Evening cocktails with breathtaking, panoramic views of the Las Vegas Strip.", locations:[{name:'Legacy Club Rooftop Cocktails', why:'Elegant downtown views'}, {name:'Skyfall Lounge', why:'Chic lounge at the Delano'},{name:'Foundation Room', why:'Lounge with a terrace at Mandalay Bay'}]},
  neonBoneyard:{ title:'Neon Boneyard', description:"A guided tour through a dazzling collection of iconic, retired Las Vegas signs. Best visited at night.", locations:[{name:'The Neon Museum Las Vegas', why:'Book tour tickets online in advance'}]},
  broadway:{ title:'Broadway Show', description:'A night of world-class theatre in the heart of Manhattan. Can be a matinee followed by dinner, or a late show followed by a stroll.', locations:[{name:'TKTS Ticket Booth Times Square', why:'Discounted same-day tickets'}, {name:'Broadway Theatre District', why:'The heart of it all'}]},
  topOfRock:{ title:'Top of the Rock', description:'Get the best, unobstructed 360° views of the NYC skyline, including the Empire State Building.', locations:[{name:'Top of the Rock Observation Deck', why:'The main viewpoint'}]},
  streetFood:{ title:'NYC Street Food', description:"A walking tour of some of NYC's most iconic and delicious street eats.", locations:[{name:"Joe's Pizza", why:'The quintessential NY slice'}, {name:"The Halal Guys", why:'Famous chicken/falafel and rice'}, {name:"A local bagel shop", why:"A morning must-have"}]},
  brooklynBridge:{ title:'Brooklyn Bridge Walk', description:'The classic walk from Brooklyn to Manhattan offers unforgettable views of the city skyline. Go early to avoid crowds.', locations:[{name:"DUMBO - Washington Street", why:"Starting point for the classic photo"}, {name:"Brooklyn Bridge Pedestrian Walkway", why:'The walk itself'}]},
  heliTour:{ title:"Manhattan Helicopter Tour", description:"A truly epic way to see the entire island of Manhattan, Statue of Liberty, and the surrounding landmarks.", locations:[{name:"Downtown Manhattan Heliport", why:"Common departure point for tours"}]}
};

/* ========== UTILITY MAPPING ========== */
const wmoIcon = (code) => ({0:"☀️",1:"🌤️",2:"⛅",3:"☁️",45:"🌫️",61:"🌦️",63:"🌧️",80:"🌧️",95:"⛈️"}[code] || "🌡️");
const wmoAnimType = (code) => ({0:"sunny",1:"cloudy",2:"cloudy",3:"cloudy",45:"cloudy",61:"rainy",63:"rainy",80:"rainy",95:"rainy"}[code] || "cloudy");
const wmoAnimHTML = (type) => {
  if (type === "rainy") return Array.from({length:32}).map(()=>`<div class="rain-drop" style="left:${Math.random()*100}%; top:${Math.random()*80}%; animation-delay:${(Math.random()*1.2).toFixed(2)}s; animation-duration:${(0.7+Math.random()*0.7).toFixed(2)}s"></div>`).join('');
  return "";
};
const weatherDescriptions = {0:"Clear",1:"Mainly Clear",2:"Partly Cloudy",3:"Overcast",45:"Fog",61:"Slight Rain",63:"Rain",80:"Showers",95:"Thunderstorm"};

</script>
</body>
</html>